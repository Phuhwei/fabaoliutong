webpackJsonp([0],{102:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(44),o=r(101),a=r(61);t.devConsole=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];["development","test"].includes("production")&&console.log.apply(console,e)},t.request=function(e){return new Promise(function(t,r){var a=o[e.method](e.url),u=e.headers,i=e.fields;null!==e.contentType&&a.set("Content-Type","application/json"),u&&Object.keys(u).forEach(function(e){a=a.set(e,u[e])}),i&&Object.keys(i).forEach(function(e){a=a.field(e,i[e])}),e.body&&(a=a.send(e.body));var l=!1;return setTimeout(function(){l||r({status:500,message:"Request time out: "+e.url})},e.timeout||8e3),a.then(function(e){l=!0,t(n.merge({},e.body,{status:e.status}))}).catch(function(e){return r(e)})})},t.findColumnNames=function(e){return Object.keys(a.dbSchema[e]).map(function(t){var r=a.dbSchema[e][t],n=r.alias,o=r.link;return n||a.dbSchema[o.table][o.column].alias})},t.findRequiredColumns=function(e){return Object.keys(a.dbSchema[e]).filter(function(t){return a.dbSchema[e][t].required})},t.wait=function(e){return new Promise(function(t){return setTimeout(t,e||1e3)})},t.mathRound=function(e){return Math.round(100*e)/100}},168:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(12),a=r(60),u=r(100),i=r(180),l=r(183);o.render(n.createElement(i.default,{store:function(){return a.createStore(l.default,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),a.applyMiddleware(u.default))}()}),document.getElementById("app"))},169:function(e,t){e.exports={app:"app","btn-primary":"btn-primary",active:"active",open:"open","dropdown-toggle":"dropdown-toggle",focus:"focus"}},170:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.database={development:{host:"localhost",name:"fabaoliutong",user:"root",password:"root"}},t.dbSchema={area:{city:{required:!0,alias:"城市"}},order:{person_id:{required:!0,link:{table:"person",column:"name"}},treasure_id:{required:!0,link:{table:"treasure",column:"name"}},unit_price_RMB:{required:!0,alias:"单价(¥)"},unit_price_CAD:{required:!0,alias:"单价($)"},quantity:{required:!0,alias:"数量"},status_id:{required:!0,link:{table:"status",column:"name"}},final_price:{required:!1,alias:"总价($)"},date:{required:!1,alias:"日期"}},person:{name:{required:!0,alias:"订购人"},area_id:{required:!0,link:{table:"area",column:"city"}},nickname:{required:!1,alias:"昵称"},address:{required:!1,alias:"地址"}},status:{name:{required:!0,alias:"状态"}},treasure:{name:{required:!0,alias:"法宝"},alias:{required:!1,alias:"别称"},default_price_RMB:{required:!1,alias:"初始价(¥)"},default_price_CAD:{required:!0,alias:"初始价($)"}}}},171:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.frontend={development:"http://localhost:5000",staging:""}},172:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(26),u=r(61),i=r(35),l=r(46),s=r(175),c=r(178),d=r(184),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.componentDidMount=function(){var e=this;i.getCurrencyRate().then(function(t){return e.props.saveToRedux({currencyRate:t.rates.CNY})})},t.prototype.render=function(){var e=this.props,t=e.saveToRedux,r=e.store;return o.createElement("article",{className:d.article},o.createElement("section",null,o.createElement("div",{className:d.topBar},o.createElement("span",null,"当前汇率：1 CAD = ",r.currencyRate," RMB"),o.createElement("button",{className:d.button,onClick:function(){t({showModal:(e={},e.order=!0,e)});var e}},"新建")),o.createElement(s.default,{table:"order"}),Object.keys(u.dbSchema).map(function(e){return o.createElement(c.default,{key:e,table:e,show:r.showModal[e]})})))},t}(o.Component);t.Container=p,t.default=a.connect(function(e){return{store:e}},{saveToRedux:l.saveToRedux})(p)},173:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(172);t.default=n.default},174:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(44),a=r(0),u=r(26),i=r(35),l=r(46),s=r(185),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.columnList=i.findColumnNames(t.props.table),t.columnWidth=100/t.columnList.length+"%",t.sortOrder=function(e,r){var n=t.props.store.tableData.order;if(!n)return[];var a=o.sortBy(n,[e]);return r?a:a.reverse()},t.handleSort=function(e){var r=t.props,n=r.store.sortOrder;(0,r.saveToRedux)({sortOrder:{sortBy:e,direction:!n.direction}})},t}return n(t,e),t.prototype.componentDidMount=function(){this.props.requestOrders()},t.prototype.render=function(){var e=this,t=this.props.store.sortOrder;return a.createElement("section",null,a.createElement("table",{className:s.table},a.createElement("tbody",null,a.createElement("tr",null,this.columnList.map(function(r){return a.createElement("th",{key:r,onClick:function(){return e.handleSort(r)}},r,r===t.sortBy&&a.createElement("div",{className:s["sort"+(t.direction?"Up":"Down")]}))})),this.sortOrder(t.sortBy,t.direction).map(function(t){return a.createElement("tr",{key:t.日期},e.columnList.map(function(e){return a.createElement("td",{key:e},"日期"===e?t[e].substr(0,10):t[e])}))}))))},t}(a.Component);t.default=u.connect(function(e){return{store:e}},{saveToRedux:l.saveToRedux,requestOrders:l.requestOrders})(c)},175:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(174);t.default=n.default},176:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(44),a=r(0),u=r(98),i=r(26),l=r(61),s=r(35),c=r(46),d=r(177),p=r(186),f=function(e){switch(e){case"order":return"lg";case"area":return"sm";default:return}},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={disableButton:!0},t.columnList=s.findColumnNames(t.props.table),t.requiredColumnList=s.findRequiredColumns(t.props.table),t.columnIdList=Object.keys(l.dbSchema[t.props.table]),t.handleDisableButton=function(){var e=t.props,r=e.store,n=e.table,o=t.requiredColumnList.map(function(e){return r.tableTemp[n][e]}).filter(function(e){return!!e});t.setState({disableButton:t.requiredColumnList.length!==o.length})},t.handleClose=function(){t.props.saveToRedux({showModal:(e={},e[t.props.table]=!1,e),tableTemp:(r={},r[t.props.table]=null,r)});var e,r},t}return n(t,e),t.prototype.render=function(){var e=this,t=this.props,r=t.table,n=t.store,i=t.show,c=t.saveToRedux;return a.createElement(u.Modal,{show:!!this.props.show,onHide:this.handleClose,bsSize:f(r),backdrop:"static"},a.createElement(u.Modal.Header,{closeButton:!0},a.createElement("h2",null,"Add ",r.toUpperCase())),a.createElement(u.Modal.Body,null,a.createElement("form",null,this.columnList.map(function(t,n){return"日期"!==t&&a.createElement("div",{key:t,className:p.field},a.createElement("label",{htmlFor:t},t+":"),a.createElement(d.default,{table:r,column:t,columnId:e.columnIdList[n],columnValue:l.dbSchema[r][e.columnIdList[n]],handleDisableButton:e.handleDisableButton}))}))),a.createElement(u.Modal.Footer,null,a.createElement("button",{disabled:this.state.disableButton,onClick:function(t){t.preventDefault(),s.insertEntry(r,n.tableTemp[r]).then(function(t){var a=t.result.insertId,u=[o.merge({id:a},n.tableTemp[r])];if("order"===r)e.props.requestOrders();else if(c({tableData:(d={},d[r]=n.tableData[r].concat(u),d),tableTemp:(p={},p[i.fromTable]=(f={},f[i.fromColumn]=""+a,f),p)}),"treasure_id"===i.fromColumn){var l=n.tableTemp[r].default_price_RMB,s=n.tableTemp[r].default_price_CAD;c({tableTemp:(m={},m[i.fromTable]={unit_price_RMB:l,unit_price_CAD:s},m)})}e.handleClose();var d,p,f,m}).catch(function(e){return console.error(e)})}},"保存")))},t}(a.Component);t.default=i.connect(function(e){return{store:e}},{saveToRedux:c.saveToRedux,requestOrders:c.requestOrders})(m)},177:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(44),a=r(0),u=r(26),i=r(35),l=r(46),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.linkTable="",t.linkColumn="",t.handleChange=function(e){var r=t.props,n=r.saveToRedux,a=r.table,u=r.columnId,l=r.store;if(n({tableTemp:(b={},b[a]=(_={},_[u]=e,_),b)}),"default_price_RMB"===u&&n({tableTemp:{treasure:{default_price_CAD:i.mathRound(parseFloat(e)/l.currencyRate)}}}),["quantity","unit_price_CAD"].includes(u)){var s=o.merge(l.tableTemp.order,(h={},h[u]=e,h)),c=s.quantity,d=s.unit_price_CAD;c&&d&&n({tableTemp:{order:{final_price:i.mathRound(c*d)}}})}if("treasure_id"===u){var p=l.tableData.treasure.filter(function(t){return t.id.toString()===e})[0],f=p.default_price_RMB,m=p.default_price_CAD;n({tableTemp:(v={},v[a]={unit_price_RMB:f,unit_price_CAD:m},v)})}i.wait(100).then(t.props.handleDisableButton);var b,_,h,v},t}return n(t,e),t.prototype.componentDidMount=function(){var e=this;if(this.props.columnValue.link){var t=this.props.columnValue.link,r=t.table,n=t.column;this.linkTable=r,this.linkColumn=n,"状态"===this.props.column&&this.props.saveToRedux({tableTemp:(o={},o[this.props.table]=(a={},a[this.props.columnId]="1",a),o)}),i.getTableData(r).then(function(t){return e.props.saveToRedux({tableData:(n={},n[r]=t.data,n)});var n})}var o,a},t.prototype.render=function(){var e=this,t=this.props,r=t.store,n=t.table,o=t.saveToRedux,u=t.columnId,i=t.column;return this.props.columnValue.alias?a.createElement("input",{id:i,value:r.tableTemp[n]&&r.tableTemp[n][u]||"",onChange:function(t){return e.handleChange(t.target.value)}}):a.createElement("div",{id:i},a.createElement("select",{value:r.tableTemp[n]&&r.tableTemp[n][u]||"0",onChange:function(t){return e.handleChange(t.target.value)}},a.createElement("option",{value:"0",disabled:!0},"请选择"),(r.tableData[this.linkTable]||[]).map(function(t){return a.createElement("option",{key:t.id,value:t.id},t[e.linkColumn])})),a.createElement("button",{onClick:function(t){t.preventDefault(),o({showModal:(r={},r[e.linkTable]={fromTable:n,fromColumn:u},r)});var r}},"新建"))},t}(a.Component);t.default=u.connect(function(e){return{store:e}},{saveToRedux:l.saveToRedux})(s)},178:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(176);t.default=n.default},179:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(26),a=r(99),u=r(173);t.default=function(e){var t=e.store;return n.createElement(o.Provider,{store:t},n.createElement(a.BrowserRouter,null,n.createElement(u.default,null)))}},180:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(179);t.default=n.default},181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(171),o=r(102),a="production";t.getOrders=function(){return o.request({method:"post",url:n.frontend[a]+"/api/order"})},t.getTableData=function(e){return o.request({method:"post",url:n.frontend[a]+"/api/table",headers:{table:e}})},t.insertEntry=function(e,t,r){return o.request({method:"post",url:n.frontend[a]+"/api/add",headers:r?{table:e,multiple:!0}:{table:e},body:t})},t.getCurrencyRate=function(){return o.request({method:"get",url:"https://api.fixer.io/latest?base=CAD"})}},182:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(35);t.saveToRedux=function(e,t){return function(r,n){return r({type:"SAVE_STORE",payload:e}),Promise.resolve(t?n()[t]:null)}},t.requestOrders=function(){return function(e){return n.getOrders().then(function(t){e({type:"SAVE_STORE",payload:{tableData:{order:t.orders}}})})}}},183:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(44);t.initialState={sortOrder:{sortBy:"日期",direction:""},showModal:{},tableTemp:{},tableData:{}},t.default=function(e,r){switch(void 0===e&&(e=t.initialState),r.type){case"CLEAR_STATE":return t.initialState;case"SAVE_STORE":return n.merge({},e,r.payload);default:return e}}},184:function(e,t){e.exports={article:"article--2KMmV",button:"button--3deeP",topBar:"topBar--3Q_Cr"}},185:function(e,t){e.exports={table:"table--33unp",sortDown:"sortDown--1dLDE",sortUp:"sortUp--3y1fM"}},186:function(e,t){e.exports={field:"field--3HhCI"}},35:function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(102)),n(r(181))},399:function(e,t,r){r(168),e.exports=r(169)},46:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(182))},61:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(170))}},[399]);